<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Stock Upside Study</title>
    <style>
        body { font-family: -apple-system, sans-serif; margin: 20px; background: #f9f9f9; color: #333; }
        h1, h2 { text-align: center; }
        #disclaimer { background: #ffeeee; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
        button { padding: 12px 24px; font-size: 18px; background: #007aff; color: white; border: none; border-radius: 8px; display: block; margin: 20px auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #eee; }
        tr:nth-child(even) { background: #f4f4f4; }
        .green { color: green; }
        .red { color: red; }
        .highlight { background: #ffffcc !important; }
        #status { text-align: center; font-style: italic; margin: 10px; }
        a { color: #007aff; }
    </style>
</head>
<body>
    <h1>ðŸ“ˆ Stock Upside Study App</h1>
    
    <div id="disclaimer">
        <strong>IMPORTANT DISCLAIMER:</strong> This is NOT financial advice. Data from public Yahoo Financeâ€”may be delayed/inaccurate. Analyst targets are opinions (often wrong). Stocks can drop; you can lose money. For educational study onlyâ€”do your own research before buying anything. Short-term "corrections" not guaranteed.
    </div>
    
    <div id="top"></div>
    
    <button id="refresh">Refresh Data</button>
    <p id="status"></p>
    
    <div id="results"></div>
    
    <p style="text-align:center;"><a href="https://finance.yahoo.com/gainers/" target="_blank">View Today's Top Gainers (Yahoo)</a> for short-term momentum ideas.</p>
    
    <script>
        const tickers = ["AAPL","MSFT","GOOGL","AMZN","META","NVDA","TSLA","AMD","PLTR","CRWD","SHOP","ABNB","PYPL","UBER","SNAP","PINS","RDDT","SMCI","ARM","MU","MRVL","ADBE","CRM","ORCL","ACLX","NEM","RL","EXPE","MELI","DIS"];
        
        async function loadData() {
            const status = document.getElementById("status");
            status.textContent = "Loading live data...";
            document.getElementById("top").innerHTML = "";
            document.getElementById("results").innerHTML = "";
            
            try {
                const symbols = tickers.join(",");
                const quoteUrl = `https://finance.yahoo.com/_finance_d/_m_yf/quote?symbols=${symbols}`;
                const quoteResp = await fetch(quoteUrl);
                if (!quoteResp.ok) throw new Error("Network error on quotes");
                const quoteData = await quoteResp.json();
                const quotes = quoteData.quoteResponse.result || [];
                
                const targetData = await Promise.all(tickers.map(async (ticker) => {
                    try {
                        const url = `https://query2.finance.yahoo.com/v10/finance/quoteSummary/${ticker}?modules=financialData`;
                        const resp = await fetch(url);
                        if (!resp.ok) return null;
                        const json = await resp.json();
                        const fd = json.quoteSummary?.result?.[0]?.financialData;
                        const target = fd?.targetMeanPrice?.raw || fd?.targetMedianPrice?.raw || null;
                        return { ticker, target };
                    } catch { return null; }
                }));
                
                const stocks = [];
                quotes.forEach((q, i) => {
                    if (!q || !targetData[i] || targetData[i].target === null) return;
                    const price = q.regularMarketPrice || 0;
                    if (price <= 0) return;
                    const changePct = q.regularMarketChangePercent || 0;
                    const target = targetData[i].target;
                    const upside = ((target - price) / price * 100);
                    if (upside > 0) {
                        stocks.push({
                            ticker: q.symbol,
                            name: q.longName || q.shortName || q.symbol,
                            price: price.toFixed(2),
                            change: changePct.toFixed(2),
                            target: target.toFixed(2),
                            upside: upside.toFixed(1)
                        });
                    }
                });
                
                stocks.sort((a, b) => b.upside - a.upside);
                
                if (stocks.length === 0) {
                    document.getElementById("results").innerHTML = "<p>No stocks with positive analyst upside right now (markets change fast).</p>";
                    status.textContent = "No data";
                    return;
                }
                
                const topStock = stocks[0];
                document.getElementById("top").innerHTML = `
                    <h2>Current Top Upside Stock for Study:</h2>
                    <p style="text-align:center; font-size:18px;"><strong>${topStock.ticker}</strong> (${topStock.name})<br>
                    ${topStock.upside}% potential upside to analyst mean target (Current: $${topStock.price} | Day change: ${topStock.change}%)</p>
                    <p style="font-size:14px;">This is the highest in the poolâ€”study its chart/news for potential short-term correction.</p>
                `;
                
                let tableHTML = `<table>
                    <thead><tr><th>Ticker</th><th>Name</th><th>Price</th><th>Day %</th><th>Target</th><th>Upside %</th></tr></thead>
                    <tbody>`;
                stocks.forEach((s, idx) => {
                    const rowClass = idx === 0 ? "class='highlight'" : "";
                    const color = s.change > 0 ? "green" : "red";
                    tableHTML += `<tr ${rowClass}>
                        <td><strong>${s.ticker}</strong></td>
                        <td>${s.name}</td>
                        <td>$${s.price}</td>
                        <td class="${color}">${s.change}%</td>
                        <td>$${s.target}</td>
                        <td><strong>${s.upside}%</strong></td>
                    </tr>`;
                });
                tableHTML += `</tbody></table>`;
                document.getElementById("results").innerHTML = tableHTML;
                
                status.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
            } catch (err) {
                status.textContent = "Error: " + err.message + ". Retry or check internet.";
            }
        }
        
        document.getElementById("refresh").addEventListener("click", loadData);
        window.onload = loadData;
    </script>
</body>
</html>

